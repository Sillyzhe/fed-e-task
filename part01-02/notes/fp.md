# 函数式编程

## 为什么学习函数式编程
- 函数式编程是随着React的流行受到越来越多的关注
- Vue3也开始拥抱函数式编程
- 函数式编程可以抛弃this
- 打包过程中可以更好的利用tree shaking过滤无用代码
- 方便测试、方便并行处理
- 有很多库可以帮助我们进行函数式开发：lodash、underscore、ramda


## 什么是函数式编程

函数式编程（Functional Programming，FP）,FP是编程范式之一，我们常听说的编程范式还有面向过程编程、面向对象编程
- 面向对象的编程方式：把现实世界中的事物抽象成程序世界中的类和对象，通过封装、继承和多态来演示事物事件的联系
- 函数式编程的思维方式：把现实世界的事物和事物之间的联系抽象到程序世界（对运算过程进行抽象）
  - 程序的本质：根据输入通过某种运算获得相应的输出，程序开发过程中会涉及很多输入和输出的函数
  - x->f(联系、映射)->y，y=f(x)
  - **函数式编程中的函数值得不是程序中的函数（方法）**，而是数学中的函数及映射关系，例如：y=sin(x)，x和y的关系
  - **相同的输入始终要得到相同的输出**（纯函数）
  - 函数式编程用来描述数据（函数）之间的映射

**前置知识**


## 函数是一等公民
- 函数可以存储在变量中
- 函数作为参数
- 函数作为返回值

在JavaScript中**函数就是一个普通的对象**（可以通过new Function()），我们可以把函数存储到变量/数组中，它还可以作为另一个函数的参数和返回值，甚至我们可以在程序运行的时候通过new Function('alert(1)')来构造一个新的函数




## 高阶函数

什么是高阶函数
- 高阶函数（Higher-order function）
  - 可以把函数作为参数传递给另一个函数
  - 可以把函数作为另一个函数的返回结果
- 函数作为参数



### 高阶函数的意义
- 抽象可以帮我们屏蔽细节，只需要关注我们的目标
- 高阶函数是用来抽象通用的问题

### 常用的高阶函数
- forEach
- map
- filter
- every
- some
- find/findIndex
- reduce
- sort
- ...


## 闭包
- 闭包（Closure）：函数和其周围的状态（词法环境）的引用捆绑在一起形成闭包
  - 可以在另一个作用域中调用一个函数的内部函数并访问到该函数的作用域中的成员

## 纯函数
- 纯函数：相同的输入永远得到相同的输出，而且没有任何可观察到的副作用
  - 纯函数就类似数学中的函数（用来描述输入和输出之间的关系），y=f(x)
  - lodash是一个纯函数的功能库，提供了对数组、数字、对象、字符串、函数等操作的一些方法
  - 数组的slice和splice分别是：纯函数和不纯函数
    - slice返回数组中的指定部分，不会改变原数组
    - splice对数组进行操作返回该数组，会改变原数组
  - 函数式编程不会保留计算中间的结果，所以变量是不可变的（无状态的）
  - 我们可以把一个函数的执行结果交给另一个函数去处理


### 好处
- 可缓存
  - 因为纯函数对相同的输入始终有相同的结果，所以可以把纯函数的结果缓存起来
- 可测试
  - 纯函数让测试更方便
- 并行处理
  - 在多线程环境下并行操作共享的内存数据很可能会出现以外情况
  - 纯函数不需要访问共享的内存数据，所以在并行环境下可以任意运行纯函数（Web Worker）

### 副作用
- 纯函数：对于相同的输入永远会得到相同的输出，而且没有任何可观察的副作用
- 副作用让一个函数变的不纯，纯函数的根据相同的输入返回相同的输出，如果函数依赖于外部的状态就无法保证相同输出，就会带来副作用

来源
- 配置文件
- 数据库
- 获取用户的输入
- ...

所有的外部交互都有可能带来副作用，副作用也使得方法通用性下降不适合扩展和可用性，同时副作用会给程序中带来安全隐患给程序带来不确定性，但是副作用不可能完全禁止，尽可能控制它们在可控范围内发生。


## 柯力化（Haskell Brooks Curry）
- 柯力化可以让我们给一个函数传递较少的参数，得到一个已经记住了某些固定参数的新函数
- 这是一种对函数参数的“缓存”
- 让函数变的更灵活，让函数的粒度更小
- 可以把多元函数转换成一元函数，可以组合使用函数产生强大的功能

## 函数组合
- 纯函数和柯力化很容易写出洋葱代码`h(g(f(x)))`
  - 获取数组的最后一个元素再转换成大写字母，`_.toUpper(_.first(_.reserse(array)))`
- 函数组合可以把细粒度的函数重新组合生成一个新的函数

概念  
- 函数组合（compose）：如果一个函数要经过多个函数处理才能得到最终值，这个时候可以把中间过程的函数合并成一个函数
  - 函数就想是数据的管道，函数组合就是把这些管道连接起来，让数据传过多个管道形成最终结果
  - **函数组合默认是从左到右执行**

## lodash中的组合函数
- lodash中组合函数flow()或者flowRight()，他们都可以组合多个函数
- flow()是从左到右运行
- flowRight()是从左到右执行，使用的更多一些

### 函数的组合要满足**结合律**(associativity)
- 我们既可以把g和h组合，还可以把f和g组合，结果都是一样的

### lodash/fp
- lodash的fp模块提供了使用的对**函数式编程友好**的方式
- 提供了不可变**auto-curried lteratee-first data-last**的方法

### Point Free
 我们可以把数据处理的过程定义成与数据无关的合成运算，不需要用到代表数据的那个参数，只要把简单的运算步骤合成到一起，在使用这种模式之前我们需要定义一些附注的基本运算函数
 - 不需要指明处理的数据
 - 只需要合成运算过程
 - 需要定义一些辅助的基本运算函数


## 函数式编程
- 认识函数式编程
- 函数相关复习
  - 函数是一等公民
  - 高级函数
  - 闭包
- 函数式编程基础
  - lodash
  - 纯函数——一个值映射成另一个值
  - 珂里化
  - 管道
  - 函数组合
- 函子
  - Functor
  - MayBe
  - Either
  - IO
  - TASK
    - folktale
  - Monad